<%- include('../partials/header') %>

<section class="hero"></section>

<div class="container" id="mods-container">
    <!-- Main Category Tabs -->
    <div class="tabs-container">
        <nav class="tabs-nav" id="main-tabs-nav">
            <div class="tab-highlight" id="main-tab-highlight"></div>
            <button class="tab-button active" data-tab="android">Android</button>
            <button class="tab-button" data-tab="ios">iOS</button>
            <button class="tab-button" data-tab="wordpress">WordPress</button>
            <button class="tab-button" data-tab="windows">Windows</button>
        </nav>
    </div>
    
    <% if (typeof filesByCategory !== 'undefined' && Object.keys(filesByCategory).length > 0) { %>
        <!-- Loop through each category provided from the backend -->
        <% Object.keys(filesByCategory).forEach(category => { %>
            <div id="<%= category %>-mods" class="tab-content <%= category === 'android' ? 'active' : '' %>">
                
                <!-- Loop through each sub-section for the category -->
                <% Object.keys(filesByCategory[category]).forEach(section => { %>
                    <section class="mod-section">
                        <div class="section-header">
                            <h2 class="section-title"><%= section.replace('-', ' ') %></h2>
                            <a href="/category?cat=<%= category %>" class="section-more">View All ></a>
                        </div>
                        <div class="mods-grid">
                            <!-- Loop through the files in this section -->
                            <% filesByCategory[category][section].forEach(file => { %>
                                <a href="/mods/<%= file._id %>" class="mod-card-link">
                                    <div class="mod-card">
                                        <% if (file.certification === 'certified') { %>
                                            <div class="app-feature-tag">âœ” Certified</div>
                                        <% } %>
                                        <div class="mod-type-tag"><%= file.version %></div>
                                        <img src="<%= file.iconUrl %>" alt="<%= file.name %>" class="mod-card-image">
                                        <div class="mod-card-content">
                                            <h3><%= file.name %></h3>
                                            <p><%= file.developer %></p>
                                            <div class="rating">
                                                <div class="stars-outer">
                                                    <div class="stars-inner" style="width: <%= (file.averageRating / 5) * 100 %>%;"></div>
                                                </div>
                                                <span class="rating-text"><%= file.averageRating.toFixed(1) %></span>
                                            </div>
                                        </div>
                                        <div class="download-overlay">
                                            <a href="/mods/<%= file._id %>" class="overlay-button overlay-btn-primary">View Mod</a>
                                            <% if (user) { %>
                                             <a href="/files/<%= file._id %>/whitelist" class="overlay-button overlay-btn-secondary">Add to Whitelist</a>
                                            <% } %>
                                        </div>
                                    </div>
                                </a>
                            <% }) %>
                        </div>
                    </section>
                <% }) %>

            </div>
        <% }) %>
    <% } else { %>
        <!-- This block will display if filesByCategory is empty or not defined -->
        <div class="no-results" style="padding: 3rem; text-align: center;">
            <h2>Could not load mods.</h2>
            <p>There was an error fetching content for the homepage. Please try again later.</p>
        </div>
    <% } %>

    <section class="upload-section">
        <h2>Have a Mod to Share?</h2>
        <p>Contribute to GPL Mods by sharing and uploading your mods.</p>
        <a href="/upload" class="upload-button">Upload Your Mod</a>
    </section>
</div>

<%- include('../partials/footer') %>