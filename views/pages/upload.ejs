<%- include('../partials/header') %>

<style>
    .upload-container { 
        max-width: 700px; 
        margin: 4rem auto; 
        padding: 3rem 2rem; 
        background-color: var(--dark-gray); 
        border-radius: 12px; 
        text-align: center;
        border: 1px solid #333;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .file-input-label { 
        display: inline-block; 
        padding: 15px 30px; 
        background: transparent; 
        color: var(--gold); 
        border: 2px dashed var(--gold); 
        border-radius: 8px; 
        cursor: pointer; 
        transition: all 0.3s ease; 
        font-size: 1.2em; 
        margin-bottom: 1rem; 
        width: 100%;
    }
    .file-input-label:hover { 
        background: rgba(255, 215, 0, 0.1); 
    }
    .submit-button { 
        display: block; 
        width: 100%; 
        background: var(--gold); 
        color: var(--black); 
        padding: 15px 20px; 
        border-radius: 8px; 
        font-weight: 700; 
        font-size: 1.2em; 
        border: none; 
        cursor: pointer; 
        transition: all 0.3s ease; 
        box-shadow: 0 0 15px var(--glow-gold); 
        margin-top: 2rem; 
    }
    .submit-button:hover { 
        transform: translateY(-2px); 
        box-shadow: 0 0 25px var(--glow-gold);
    }
    .submit-button:disabled { 
        background-color: #555; 
        color: #aaa; 
        cursor: not-allowed; 
        box-shadow: none; 
        transform: none; 
    }
    #file-name-display { 
        margin-top: 15px; 
        color: var(--white); 
        font-weight: 600; 
        font-size: 1.1em;
    }
    
    /* Loading Spinner */
    .loader-container { display: none; margin-top: 20px; }
    .loader { 
        margin: 0 auto; 
        border: 4px solid #333; 
        border-top: 4px solid var(--gold); 
        border-radius: 50%; 
        width: 40px; 
        height: 40px; 
        animation: spin 1s linear infinite; 
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>

<div class="container">
    <div class="upload-container">
        <h2 style="color: var(--gold); margin-bottom: 10px; font-size: 2.2em;">Upload Mod File</h2>
        <p style="color: var(--silver); margin-bottom: 2.5rem;">Step 1 of 2: Select the primary mod file (.zip, .apk, .exe). It will be securely uploaded to the cloud and scanned for safety.</p>
        
        <!-- Notice the action is now pointing to /upload-initial -->
        <form action="/upload-initial" method="POST" enctype="multipart/form-data" id="initialUploadForm">
            
            <div class="form-group">
                <label for="modFile" class="file-input-label" id="drop-zone">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 2em; display: block; margin-bottom: 10px;"></i>
                    Click to Choose File
                </label>
                <!-- Hidden file input -->
                <input type="file" id="modFile" name="modFile" required style="display:none;">
                
                <div id="file-name-display">No file selected</div>
            </div>
            
            <!-- Loading Animation -->
            <div class="loader-container" id="loaderContainer">
                <div class="loader"></div>
                <p style="color: var(--gold); margin-top: 15px;">Uploading to cloud & initiating safety scan...<br><span style="color: var(--silver); font-size: 0.85em;">Please do not close this page. Large files may take a minute.</span></p>
            </div>

            <button type="submit" class="submit-button" id="submitBtn">Upload & Continue</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const fileInput = document.getElementById('modFile');
        const fileNameDisplay = document.getElementById('file-name-display');
        const form = document.getElementById('initialUploadForm');
        const submitBtn = document.getElementById('submitBtn');
        const loaderContainer = document.getElementById('loaderContainer');
        const dropZone = document.getElementById('drop-zone');

        // Update UI when file is selected
        fileInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                fileNameDisplay.textContent = 'Ready to upload: ' + this.files[0].name;
                dropZone.style.borderColor = 'var(--gold)';
                dropZone.style.backgroundColor = 'rgba(255, 215, 0, 0.05)';
            } else {
                fileNameDisplay.textContent = 'No file selected';
                dropZone.style.borderColor = 'var(--gold)';
                dropZone.style.backgroundColor = 'transparent';
            }
        });

        // Handle form submission and show loading state
        form.addEventListener('submit', function(e) {
            if (fileInput.files.length === 0) {
                e.preventDefault();
                alert("Please select a file to upload first.");
                return;
            }
            
            // Disable the button to prevent double-clicks
            submitBtn.disabled = true;
            submitBtn.innerHTML = 'Processing...';
            
            // Show the loading spinner
            loaderContainer.style.display = 'block';
        });
    });
</script>

<%- include('../partials/footer') %>