<%- include('../partials/header') %>

<style>
    /* Page-specific styles for the upload form */
    .upload-form-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        background-color: var(--dark-grey);
        border: 1px solid var(--light-grey);
        border-radius: 8px;
    }

    .form-section {
        margin-bottom: 2rem;
        border-bottom: 1px solid var(--light-grey);
        padding-bottom: 2rem;
    }
    
    .form-section:last-of-type {
        border-bottom: none;
        padding-bottom: 0;
        margin-bottom: 0;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
        color: var(--silver);
    }

    .form-group input[type="text"],
    .form-group input[type="url"],
    .form-group textarea,
    .form-group select {
        width: 100%;
        padding: 10px;
        background-color: var(--black);
        border: 1px solid var(--light-grey);
        border-radius: 4px;
        color: var(--white);
        font-size: 1rem;
    }

    .form-group textarea {
        min-height: 150px;
        resize: vertical;
    }

    .form-group input[type="file"] {
        color: var(--silver);
    }
    
    .icon-preview-wrapper {
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }
    
    #iconPreview {
        width: 100px;
        height: 100px;
        background-color: var(--black);
        border: 1px dashed var(--light-grey);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--silver);
        text-align: center;
        overflow: hidden; /* This will contain the image */
    }
    
    #iconPreview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .checkbox-group label {
        margin-right: 1rem;
        color: var(--white);
        font-weight: normal;
    }

</style>

<div class="container">
    <div class="upload-form-container">
        <h2 style="text-align: center; margin-bottom: 2rem;">Upload Your Mod</h2>

        <!-- The 'enctype' is CRUCIAL for file uploads -->
        <form action="/upload" method="POST" enctype="multipart/form-data" id="uploadForm">

            <!-- Section 1: Basic Information -->
            <fieldset class="form-section">
                <legend><h3>1. Basic Information</h3></legend>
                
                <div class="form-group icon-preview-wrapper">
                    <div id="iconPreview">
                        <span>Icon Preview</span>
                    </div>
                    <div>
                        <label for="softwareIcon">Software Icon*</label>
                        <input type="file" id="softwareIcon" name="softwareIcon" accept="image/png, image/jpeg" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="softwareName">Name*</label>
                    <input type="text" id="softwareName" name="softwareName" placeholder="e.g., Ultimate Graphics Mod" required>
                </div>

                <div class="form-group">
                    <label for="softwareVersion">Version*</label>
                    <input type="text" id="softwareVersion" name="softwareVersion" placeholder="e.g., 2.1.0" required>
                </div>

                <div class="form-group">
                    <label for="developerName">Original Developer/Company</label>
                    <input type="text" id="developerName" name="developerName" placeholder="e.g., CD PROJEKT RED, Adobe, etc.">
                </div>
            </fieldset>

            <!-- Section 2: Descriptions -->
            <fieldset class="form-section">
                <legend><h3>2. Descriptions</h3></legend>
                <div class="form-group">
                    <label for="modDescription">Mod Description*</label>
                    <textarea id="modDescription" name="modDescription" placeholder="Describe the features of your mod, what it does, and how to use it." required></textarea>
                </div>
                <div class="form-group">
                    <label for="officialDescription">Official Description</label>
                    <textarea id="officialDescription" name="officialDescription" placeholder="Provide the original description of the software from the official source."></textarea>
                </div>
            </fieldset>

            <!-- Section 3: Media -->
            <fieldset class="form-section">
                <legend><h3>3. Media</h3></legend>
                <div class="form-group">
                    <label for="screenshots">Screenshots* (Up to 4, at least 1 required)</label>
                    <input type="file" id="screenshots" name="screenshots" accept="image/png, image/jpeg" multiple>
                </div>
                 <div class="form-group">
                    <label for="videoUrl">YouTube/Vimeo Video URL (Optional)</label>
                    <input type="url" id="videoUrl" name="videoUrl" placeholder="https://www.youtube.com/watch?v=...">
                </div>
            </fieldset>
            
            <!-- Section 4: Categorization -->
            <fieldset class="form-section">
                <legend><h3>4. Categorization</h3></legend>

                <div class="form-group">
                    <label for="category">Main Category*</label>
                    <select id="category" name="category" required>
                        <option value="" disabled selected>Select a category</option>
                        <option value="windows">Windows</option>
                        <option value="android">Android</option>
                        <option value="ios">iOS</option>
                        <option value="wordpress">WordPress</option>
                    </select>
                </div>

                <div class="form-group checkbox-group">
                    <label>Supported Platforms*</label><br>
                    <input type="checkbox" id="platformWin" name="platforms" value="windows"> <label for="platformWin">Windows</label>
                    <input type="checkbox" id="platformMac" name="platforms" value="macos"> <label for="platformMac">macOS</label>
                    <input type="checkbox" id="platformLinux" name="platforms" value="linux"> <label for="platformLinux">Linux</label>
                    <input type="checkbox" id="platformAndroid" name="platforms" value="android"> <label for="platformAndroid">Android</label>
                    <input type="checkbox" id="platformIos" name="platforms" value="ios"> <label for="platformIos">iOS</label>
                </div>
                 <div class="form-group">
                    <label for="tags">Tags (Comma-separated)</label>
                    <input type="text" id="tags" name="tags" placeholder="e.g., utility, editor, productivity, action">
                </div>
            </fieldset>
            
             <!-- Section 5: The File Itself -->
            <fieldset class="form-section">
                <legend><h3>5. The Mod File*</h3></legend>
                <div class="form-group">
                    <label for="modFile">Select your mod file (.exe, .msi, .rar, .zip, .apk, etc.)</label>
                    <input type="file" id="modFile" name="modFile" required>
                </div>
            </fieldset>

            <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px; font-size: 1.2rem;">Upload File</button>

        </form>
    </div>
</div>

<script>
// This script is specific to the upload page
document.addEventListener('DOMContentLoaded', () => {
    const iconInput = document.getElementById('softwareIcon');
    const iconPreview = document.getElementById('iconPreview');
    const uploadForm = document.getElementById('uploadForm');
    const screenshotsInput = document.getElementById('screenshots');

    // 1. Live Icon Preview
    iconInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            iconPreview.innerHTML = ''; // Clear previous content
            reader.onload = function(event) {
                const img = document.createElement('img');
                img.setAttribute('src', event.target.result);
                iconPreview.appendChild(img);
            }
            reader.readAsDataURL(file);
        } else {
            iconPreview.innerHTML = '<span>Icon Preview</span>';
        }
    });
    
    // 2. Form submission validation
    uploadForm.addEventListener('submit', function(event) {
        // Check for number of screenshots
        if (screenshotsInput.files.length < 1) {
            alert('Error: You must upload at least one screenshot.');
            event.preventDefault(); // Stop form submission
            return;
        }
        
        if (screenshotsInput.files.length > 4) {
            alert('Error: You cannot upload more than 4 screenshots.');
            event.preventDefault(); // Stop form submission
            return;
        }
        
        // Add any other front-end validation you need here
    });
});
</script>

<%- include('../partials/footer') %>