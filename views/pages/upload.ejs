<%- include('../partials/header') %>

<main>
    <div class="page-header">
        <div class="container">
            <h1>Upload <span>Your Mod</span></h1>
            <p>Contribute to the community by sharing your creation. All submissions are reviewed by our team.</p>
        </div>
    </div>
    
    <div class="container">
        <div class="upload-layout">
            <!-- Upload Form -->
            <form class="upload-form" action="/upload" method="POST" enctype="multipart/form-data">
                
                <!-- Mod Icon Preview & Upload -->
                <div class="icon-upload-container">
                    <label>Mod Icon</label>
                    <div class="icon-preview" id="iconPreviewBox">
                        <img id="iconImage" src="" alt="Icon Preview">
                        <span id="iconPlaceholder">Preview</span>
                    </div>
                    <div class="file-input-wrapper" style="max-width: 250px;">
                        <input type="file" id="softwareIcon" name="softwareIcon" accept="image/*" required>
                        <label for="softwareIcon" class="file-input-label">Choose Icon</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="softwareName">Mod Name</label>
                    <input type="text" id="softwareName" name="softwareName" placeholder="e.g., Galaxy Invaders [Mod Menu]" required>
                </div>

                <div class="form-group">
                    <label for="developerName">Official Developer / Company</label>
                    <input type="text" id="developerName" name="developerName" placeholder="e.g., Supercell or Mojang">
                </div>

                <div class="form-group">
                    <label for="category">Platform</label>
                    <select id="category" name="category" required>
                        <option value="" disabled selected>Select a platform...</option>
                        <option value="android">Android</option>
                        <option value="ios-jailed">iOS - Jailed (IPA)</option>
                        <option value="ios-jailbroken">iOS - Jailbroken (DEB)</option>
                        <option value="windows">Windows</option>
                        <option value="wordpress">WordPress</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="subCategory">Category</label>
                    <select id="subCategory" name="subCategory" required disabled>
                        <option value="" disabled selected>Select a platform first...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="softwareVersion">Mod Version</label>
                    <input type="text" id="softwareVersion" name="softwareVersion" placeholder="e.g., 3.2.5" required>
                </div>

                <div class="form-group">
                    <label for="modDescription">Mod Features</label>
                    <textarea id="modDescription" name="modDescription" placeholder="Describe the modifications (e.g., Unlimited Coins, God Mode)" required></textarea>
                </div>

                <div class="form-group">
                    <label for="officialDescription">What's New (Optional)</label>
                    <textarea id="officialDescription" name="officialDescription" placeholder="What's new in this version?"></textarea>
                </div>

                <div class="form-group">
                    <label for="tags">Tags (Optional)</label>
                    <input type="text" id="tags" name="tags" placeholder="strategy, multiplayer, offline">
                </div>

                <div class="form-group">
                    <label>Mod File</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="modFile" name="modFile" accept=".apk,.xapk,.ipa,.deb,.zip,.exe,.msi" required>
                        <label for="modFile" class="file-input-label">Choose Mod File</label>
                        <span class="file-name" id="modFileName">No file selected</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Mod Screenshots (Up to 4)</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="screenshots" name="screenshots" accept="image/png, image/jpeg" multiple required>
                        <label for="screenshots" class="file-input-label">Choose Screenshots</label>
                        <span class="file-name" id="screenshotFileName">No file selected</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="videoUrl">Video URL (Optional)</label>
                    <input type="url" id="videoUrl" name="videoUrl" placeholder="https://www.youtube.com/watch?v=...">
                </div>

                <button type="submit" class="submit-button">Submit Mod for Review</button>
            </form>
            
            <!-- Submission Guidelines -->
            <aside class="guidelines">
                <h3>Submission Guidelines</h3>
                <ul>
                    <li><b>Be Accurate:</b> The mod name, version, and developer details must be correct.</li>
                    <li><b>Safety First:</b> Mods containing malware or harmful code result in a permanent ban.</li>
                    <li><b>Testing:</b> Ensure the mod works as described before uploading.</li>
                    <li><b>Media:</b> High-quality icons and screenshots improve approval chances.</li>
                </ul>
            </aside>
        </div>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- Icon Preview Logic ---
        const softwareIcon = document.getElementById('softwareIcon');
        const iconImage = document.getElementById('iconImage');
        const iconPlaceholder = document.getElementById('iconPlaceholder');

        softwareIcon.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    iconImage.src = e.target.result;
                    iconImage.style.display = 'block';
                    iconPlaceholder.style.display = 'none';
                }
                reader.readAsDataURL(file);
            }
        });

        // --- Dynamic Category Dropdown Logic ---
        const platformSelect = document.getElementById('category');
        const subCategorySelect = document.getElementById('subCategory');

        const categoriesByPlatform = {
            android: ['Game - Action', 'Game - Adventure', 'Game - Puzzle', 'Game - RPG', 'App - Productivity', 'App - Social', 'App - Tools', 'Other'],
            'ios-jailed': ['Game - Action', 'Game - Adventure', 'Game - Puzzle', 'Game - RPG', 'App - Productivity', 'App - Social', 'App - Tools', 'Other'],
            'ios-jailbroken': ['Tweak', 'Theme', 'Utility', 'Widget', 'Other'],
            windows: ['Software - Utility', 'Software - Multimedia', 'Software - Security', 'Software - Development', 'Game', 'Other'],
            wordpress: ['Plugin - SEO', 'Plugin - Security', 'Plugin - E-commerce', 'Plugin - Page Builder', 'Theme - Portfolio', 'Theme - E-commerce', 'Theme - Blog', 'Other']
        };

        platformSelect.addEventListener('change', function() {
            const selectedPlatform = this.value;
            const categories = categoriesByPlatform[selectedPlatform] || [];
            subCategorySelect.innerHTML = '';
            if (categories.length > 0) {
                subCategorySelect.disabled = false;
                let defaultOption = document.createElement('option');
                defaultOption.text = 'Select a category...';
                defaultOption.value = '';
                defaultOption.disabled = true;
                defaultOption.selected = true;
                subCategorySelect.add(defaultOption);
                categories.forEach(function(category) {
                    let option = document.createElement('option');
                    option.text = category;
                    option.value = category.toLowerCase().replace(/ /g, '-');
                    subCategorySelect.add(option);
                });
            } else {
                subCategorySelect.disabled = true;
            }
        });

        // --- File Name Display Logic ---
        const setupFileNameDisplay = (inputId, spanId) => {
            const input = document.getElementById(inputId);
            const span = document.getElementById(spanId);
            input.addEventListener('change', function() {
                if (this.files.length > 1) {
                    span.textContent = this.files.length + ' files selected';
                } else {
                    span.textContent = this.files.length > 0 ? this.files[0].name : 'No file selected';
                }
            });
        };

        setupFileNameDisplay('modFile', 'modFileName');
        setupFileNameDisplay('screenshots', 'screenshotFileName');
    });
</script>

<%- include('../partials/footer') %>