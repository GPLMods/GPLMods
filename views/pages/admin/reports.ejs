<%- include('../../partials/header') %>

<style>
    /* Using existing table styles and adding layout for actions */
    .report-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1.5rem;
        font-size: 0.9rem;
    }
    .report-table th, .report-table td {
        padding: 10px 12px;
        border: 1px solid var(--light-grey);
        text-align: left;
    }
    .report-table thead { background-color: #3d2f0b; } /* Darker gold for admin header */
    .report-table tbody tr:hover { background-color: var(--light-grey); }
    
    /* Status colors */
    .status-open { color: #ffadad; /* light red */ }
    .status-resolved { color: #b0ffb0; /* light green */ }
    .status-ignored { color: var(--silver); }

    /* Action button container */
    .actions-cell {
        text-align: right; 
        display: flex; 
        gap: 0.5rem; 
        justify-content: flex-end;
    }
</style>

<div class="container">
    <div class="profile-header">
        <h1>Admin Dashboard</h1>
        <p>File Report Management</p>
    </div>

    <section class="reports-list">
        <h2>Submitted Reports</h2>
        <% if(reports && reports.length > 0) { %>
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Reported File</th>
                        <th>Reason & Comments</th>
                        <th>Reported By</th>
                        <th>Date</th>
                        <th style="text-align: right;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% reports.forEach(report => { %>
                        <tr>
                            <td class="status-<%= report.status %>">
                                <strong><%= report.status.toUpperCase() %></strong>
                            </td>
                            <td>
                                <% if (report.file) { %>
                                    <a href="/mods/<%= report.file._id %>" target="_blank"><%= report.reportedFileName %></a>
                                <% } else { %>
                                    <span style="color: #a04040;">[File Deleted]</span>
                                <% } %>
                            </td>
                            <td>
                                <strong><%= report.reason %>:</strong>
                                <em style="color:var(--silver);"><%= report.additionalComments || 'N/A' %></em>
                            </td>
                            <td><%= report.reportingUsername %></td>
                            <td><%= report.createdAt.toLocaleString() %></td>
                            
                            <td class="actions-cell">
                                <% if (report.status === 'open') { %>
                                    <!-- Form to mark as resolved -->
                                    <form action="/admin/reports/<%= report._id %>/status" method="POST" style="margin:0;">
                                        <input type="hidden" name="status" value="resolved">
                                        <button type="submit" class="btn btn-secondary" style="padding: 4px 8px; font-size: 0.8rem; background-color:#5db05d; border-color:#5db05d;">Resolve</button>
                                    </form>
                                    <!-- Form to mark as ignored -->
                                    <form action="/admin/reports/<%= report._id %>/status" method="POST" style="margin:0;">
                                        <input type="hidden" name="status" value="ignored">
                                        <button type="submit" class="btn btn-secondary" style="padding: 4px 8px; font-size: 0.8rem;">Ignore</button>
                                    </form>
                                <% } %>

                                <!-- Form to delete the file -->
                                <% if (report.file) { %>
                                    <form action="/admin/reports/delete-file/<%= report.file._id %>" method="POST" onsubmit="return confirm('Are you sure you want to permanently delete this file? This cannot be undone.');" style="margin:0;">
                                        <button type="submit" class="btn btn-secondary" style="padding: 4px 8px; font-size: 0.8rem; background-color:#a04040; border-color:#a04040;">Delete File</button>
                                    </form>
                                <% } %>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        <% } else { %>
            <div class="no-uploads">
                <p>There are currently no open reports. Great job!</p>
            </div>
        <% } %>
    </section>
</div>

<%- include('../../partials/footer') %>